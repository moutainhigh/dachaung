<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <style type="text/css">
        .layui-form-item .layui-input-inline {
            width: 300px;
        }

        .layui-inline {
            margin-right: 100px;
        }
    </style>
</head>

<body>
    <div class="layuimini-container">
        <div class="layuimini-main">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>资产核查</legend>
            </fieldset>

            <form class="layui-form" action="" lay-filter="checkAssetMSG">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">资产ID</label>
                        <div class="layui-input-inline">
                            <input type="text" name="assetId" id="assetId" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">所属项目</label>
                        <div class="layui-input-inline">
                            <input type="text" name="projectId" id="projectId" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">资产名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="assetName" id="assetName" lay-verify="require" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">品牌</label>
                        <div class="layui-input-inline">
                            <input type="text" name="assetBrand" id="assetBrand" lay-verify="require" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">规格型号</label>
                        <div class="layui-input-inline">
                            <input type="tel" name="assetModel" id="assetModel" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">厂商</label>
                        <div class="layui-input-inline">
                            <input type="text" name="manufacturer" id="manufacturer" lay-verify="require" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">厂址</label>
                        <div class="layui-input-inline">
                            <input type="text" name="factorySite" id="factorySite" lay-verify="require" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">计量单位</label>
                        <div class="layui-input-inline">
                            <select name="unit" lay-filter="unit" disabled>
                                <option value=""></option>
                                <option value="台">台</option>
                                <option value="套">套</option>
                                <option value="批">批</option>
                                <option value="米">米</option>
                                <option value="吨">吨</option>
                                <option value="箱">箱</option>
                                <option value="个">个</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">数量</label>
                        <div class="layui-input-inline">
                            <input type="number" name="quantity" id="quantity" lay-verify="number" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">单价</label>
                        <div class="layui-input-inline">
                            <input type="number" name="unitPrice" id="unitPrice" lay-verify="number" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">金额</label>
                        <div class="layui-input-inline">
                            <input type="number" name="amount" id="amount" lay-verify="number" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">资产类型</label>
                        <div class="layui-input-inline">
                            <select name="assetType" lay-filter="assetType" disabled>
                                <option value="">请选择资产类型</option>
                                <option value="硬件">硬件</option>
                                <option value="软件">软件</option>
                                <option value="备品备件">备品备件</option>
                            </select>
                        </div>
                    </div>

                    <!-- 此处应使用日期控件 -->
                    <div class="layui-inline">
                        <label class="layui-form-label">采购日期</label>
                        <div class="layui-input-inline">
                            <input type="text" id="purchaseDate" name="purchaseDate" lay-verify="date" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                </div>
                <!-- 多 select的layui-item -->
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">采购渠道</label>
                        <div class="layui-input-inline">
                            <select name="wayBuying" lay-filter="wayBuying" disabled>
                                <option value=""></option>
                                <option value="经销商">经销商</option>
                                <option value="集成商">集成商</option>
                                <option value="代理商">代理商</option>
                                <option value="产商直供">产商直供</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">采购类型</label>
                        <div class="layui-input-inline">
                            <select name="typeBuying" lay-filter="typeBuying" disabled>
                                <option value=""></option>
                                <option value="公开招标">公开招标</option>
                                <option value="谈判">谈判</option>
                                <option value="单一来源">单一来源</option>
                                <option value="直签继签">直签继签</option>
                                <option value="其它">其它</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">质保类型</label>
                        <div class="layui-input-inline">
                            <select name="warrantyType" lay-filter="warrantyType" disabled>
                                <option value=""></option>
                                <option value="原厂质保">原厂质保</option>
                                <option value="集成商质保">集成商质保</option>
                                <option value="经销或代理商质保">经销或代理商质保</option>
                                <option value="未约定">未约定</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">质保等级</label>
                        <div class="layui-input-inline">
                            <select name="warrantyLevel" lay-filter="warrantyLevel" disabled>
                                <option value=""></option>
                                <option value="上门服务">上门服务</option>
                                <option value="免费维修">免费维修</option>
                                <option value="免费更换">免费更换</option>
                                <option value="技术指导">技术指导</option>
                                <option value="电话支持">电话支持</option>
                                <option value="未明确约定">未明确约定</option>
                                <option value="其它">其它</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">质保天数</label>
                        <div class="layui-input-inline">
                            <select name="warrantyDays" lay-filter="warrantyDays" disabled>
                                <option value=""></option>
                                <option value="0">无质保期</option>
                                <option value="1" selected="">1个月</option>
                                <option value="3">3个月</option>
                                <option value="6">半年</option>
                                <option value="12">1年</option>
                                <option value="24">2年</option>
                                <option value="36">3年</option>
                                <option value="48">4年</option>
                                <option value="60">5年</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label">质保日期至</label>
                        <div class="layui-input-inline">
                            <div class="layui-input-inline">
                                <input type="text" id="warrantyDateTo" name="warrantyDateTo" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text" style="width:1280px;">
                    <label class="layui-form-label">参数说明</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" class="layui-textarea" name="parameterDescription" id="parameterDescription" readonly="readonly"></textarea>
                    </div>
                </div>

                <div class="layui-form-item" style="width:1280px;">
                    <label class="layui-form-label">备注</label>
                    <div class="layui-input-block">
                        <input type="text" name="remarks" id="remarks" lay-verify="" placeholder="" autocomplete="off" class="layui-input" readonly="readonly">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
                    </div>
                </div>
        </form>
            <!-- 上传表格按钮 -->
            <div class="layui-form-item">
                <label class="layui-form-label">指标上传</label>
                <div class="layui-input-block">
                    <div class="layui-upload">
                        <button type="button" class="layui-btn layui-btn-normal" id="test8">选择指标文件</button>
                        <button type="button" class="layui-btn" id="test9">开始上传</button>
                    </div>
                </div>
            </div>
            <!-- 指标审查所用表格 -->
            <div class="layui-form-item" style="width: 100%;margin: 0 auto;">
                <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
            </div>
    </div>
    </div>
</body>
    <script src="../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
    <script>
        layui.use(['form', 'layedit', 'laydate', 'upload', 'table'], function () {
            var form = layui.form
                , layer = layui.layer
                , layedit = layui.layedit
                , laydate = layui.laydate
                , upload = layui.upload
                , table = layui.table
                , $ = layui.jquery;

            table.render({
                elem: '#currentTableId',
                url: '../../api/table_check_assets_msg_copy.json',
                toolbar: '#toolbarDemo',
                defaultToolbar: ['filter', 'exports', 'print', {
                    title: '指标',
                    layEvent: 'LAYTABLE_TIPS',
                    icon: 'layui-icon-tips'
                }],
                cols: [[
                    { field: 'review_type', width: "15%", title: '资产类型' },
                    { field: 'review_content', width: "15%", title: '检查项目' },
                    { field: 'review_claim', width: "15%", title: '技术要求' },
                    { field: 'review_result', width: "15%", title: '指标目标' },
                    { field: 'audit_conclusion', width: "15%", title: '审核结论', sort: true, edit: 'text' },
                    { field: 'remark', width: "25%", title: '备注', edit: 'text' },
                ]],
                limits: [10, 15, 20, 25, 50, 100],
                limit: 15,
                page: true,
                skin: 'line'
            });

            //拿到数据然后进行数据查询，然后为input赋值
            var parent_json;
            $(function () {
                parent_json = eval('('+parent.json+')');
            });
            form.val("checkAssetMSG", parent_json);
            //日期
            laydate.render({
                elem: '#purchaseDate',
                format:'yyyy/MM/dd'
            });
            laydate.render({
                elem: '#warrantyDateTo',
                format:'yyyy/MM/dd'
            });
            //直接将金额计算得出
            $( "#quantity").bind("input propertychange",function () {
                var quantity = $('#quantity').val();
                var unitPrice = $('#unitPrice').val();
                console.log("quantity:"+quantity+"           unitPrice:"+unitPrice);
                if(!isNaN(quantity) && !isNaN(unitPrice)){
                    var res = parseFloat(quantity)*parseFloat(unitPrice);
                    $("#amount").val(res);
                }
            });
            $( "#unitPrice").bind("input propertychange",function () {
                var quantity = $('#quantity').val();
                var unitPrice = $('#unitPrice').val();
                console.log("quantity:"+quantity+"           unitPrice:"+unitPrice);
                if(!isNaN(quantity) && !isNaN(unitPrice)){
                    var res = parseFloat(quantity)*parseFloat(unitPrice);
                    $("#amount").val(res);
                }
            });
            //将select得到的值直接转化成日期
            function formatMonth(num){
                var str;
                if(num<10){
                    str = "0"+num;
                }else{
                    str = ""+num;
                }
                return str;
            }
            // dateArr 0代表年 1代表月 2代表日 caseValue代表增加的月份
            function getNewDate(dateArr , caseValue){
                if(Number(dateArr[1])<12-(caseValue-1)){
                    dateArr[1] = formatMonth( (Number(dateArr[1])+caseValue) );
                }else {
                    dateArr[0] = Number(dateArr[0])+1+"";
                    dateArr[1] = formatMonth((Number(dateArr[1])+caseValue-12));
                }
                var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                return newDate;
            }
            form.on('select(warrantyDays)', function(data){
                var purchaseDate = $('#purchaseDate').val();
                var dateArr = purchaseDate.split("/");
                switch (Number(data.value)) {
                    case 0 :
                        laydate.render({elem: '#warrantyDateTo',value: purchaseDate});
                        break;
                    case 1 :
                        laydate.render({elem: '#warrantyDateTo',value: getNewDate(dateArr,Number(data.value))});
                        break;
                    case 3 :
                        laydate.render({elem: '#warrantyDateTo',value: getNewDate(dateArr,Number(data.value))});
                        break;
                    case 6 :
                        laydate.render({elem: '#warrantyDateTo',value: getNewDate(dateArr,Number(data.value))});
                        break;
                    case 12 :
                        //直接加一年
                        dateArr[0] = Number(dateArr[0])+1+"";
                        var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                        laydate.render({elem: '#warrantyDateTo',value: newDate});
                        break;
                    case 24 :
                        dateArr[0] = Number(dateArr[0])+2+"";
                        var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                        laydate.render({elem: '#warrantyDateTo',value: newDate});
                        break;
                    case 36 :
                        dateArr[0] = Number(dateArr[0])+3+"";
                        var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                        laydate.render({elem: '#warrantyDateTo',value: newDate});
                        break;
                    case 48 :
                        dateArr[0] = Number(dateArr[0])+4+"";
                        var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                        laydate.render({elem: '#warrantyDateTo',value: newDate});
                        break;
                    case 60 :
                        dateArr[0] = Number(dateArr[0])+5+"";
                        var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                        laydate.render({elem: '#warrantyDateTo',value: newDate});
                        break;
                }
            });

            //指定允许上传的文件类型
            upload.render({
                elem: '#test8'
                , url: 'https://httpbin.org/post' //改成您自己的上传接口
                , accept: 'file' //普通文件
                , done: function (res) {
                    layer.msg('上传成功');
                    console.log(res);
                }
            });
        })
    </script>