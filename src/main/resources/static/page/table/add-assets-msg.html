<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>添加资产信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
    <style type="text/css">
        .layui-form-item .layui-input-inline {
            width: 300px;
        }
        .layui-inline {
            margin-right: 100px;
        }
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>资产入库</legend>
        </fieldset>
        <form class="layui-form" action=" " lay-filter="addAssetMSG">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">资产ID</label>
                    <div class="layui-input-inline">
                        <input type="tel" name="assetId" id="assetId" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">所属项目</label>
                    <div class="layui-input-inline">
                        <input type="tel" name="projectId" id="projectId" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">资产名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="assetName" id="assetName" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">品牌</label>
                    <div class="layui-input-inline">
                        <input type="text" name="assetBrand" id="assetBrand"  lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">规格型号</label>
                    <div class="layui-input-inline">
                        <input type="tel" name="assetModel" id="assetModel" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">厂商</label>
                    <div class="layui-input-inline">
                        <input type="text" name="manufacturer" id="manufacturer" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">厂址</label>
                    <div class="layui-input-inline">
                        <input type="text" name="factorySite" id="factorySite" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">计量单位</label>
                    <div class="layui-input-inline">
                        <select name="unit" lay-filter="unit">
                            <option value=""></option>
                            <option value="台">台</option>
                            <option value="套" selected="">套</option>
                            <option value="批">批</option>
                            <option value="米">米</option>
                            <option value="吨">吨</option>
                            <option value="箱">箱</option>
                            <option value="个">个</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">数量</label>
                    <div class="layui-input-inline">
                        <input type="text" name="quantity" id="quantity" lay-verify="required|number" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">单价</label>
                    <div class="layui-input-inline">
                        <input type="text" name="unitPrice" id="unitPrice" lay-verify="required|number" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <!--写js事件 进行自动计算-->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">金额</label>
                    <div class="layui-input-inline">
                        <input type="text" name="amount" id="amount"  lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">资产类型</label>
                    <div class="layui-input-inline">
                        <select name="assetType" lay-filter="assetType">
                            <option value="">请选择资产类型</option>
                            <option value="硬件">硬件</option>
                            <option value="软件" selected="">软件</option>
                            <option value="备品备件">备品备件</option>
                        </select>
                    </div>
                </div>

                <!-- 此处应使用日期控件 -->
                <div class="layui-inline">
                    <label class="layui-form-label">采购日期</label>
                    <div class="layui-input-inline">
                        <input type="text" id="purchaseDate" name="purchaseDate" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <!-- 多 select的layui-item -->
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">采购渠道</label>
                    <div class="layui-input-inline">
                        <select name="wayBuying" lay-filter="wayBuying">
                            <option value=""></option>
                            <option value="经销商">经销商</option>
                            <option value="集成商" selected="">集成商</option>
                            <option value="代理商">代理商</option>
                            <option value="产商直供">产商直供</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">采购类型</label>
                    <div class="layui-input-inline">
                        <select name="typeBuying" lay-filter="typeBuying">
                            <option value=""></option>
                            <option value="公开招标">公开招标</option>
                            <option value="谈判" selected="">谈判</option>
                            <option value="单一来源">单一来源</option>
                            <option value="直签继签">直签继签</option>
                            <option value="其它">其它</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">质保类型</label>
                    <div class="layui-input-inline">
                        <select name="warrantyType" lay-filter="warrantyType">
                            <option value=""></option>
                            <option value="原厂质保">原厂质保</option>
                            <option value="集成商质保" selected="">集成商质保</option>
                            <option value="经销或代理商质保">经销或代理商质保</option>
                            <option value="未约定">未约定</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">质保等级</label>
                    <div class="layui-input-inline">
                        <select name="warrantyLevel" lay-filter="warrantyLevel">
                            <option value=""></option>
                            <option value="上门服务">上门服务</option>
                            <option value="免费维修" selected="">免费维修</option>
                            <option value="免费更换">免费更换</option>
                            <option value="技术指导">技术指导</option>
                            <option value="电话支持">电话支持</option>
                            <option value="未明确约定">未明确约定</option>
                            <option value="其它">其它</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">质保天数</label>
                    <div class="layui-input-inline">
                        <select name="warrantyDays" lay-filter="warrantyDays">
                            <option value=""></option>
                            <option value="0">无质保期</option>
                            <option value="1" selected="">1个月</option>
                            <option value="3">3个月</option>
                            <option value="6">半年</option>
                            <option value="12">1年</option>
                            <option value="24">2年</option>
                            <option value="36">3年</option>
                            <option value="48">4年</option>
                            <option value="60">5年</option>
                        </select>
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label">质保日期至</label>
                    <div class="layui-input-inline">
                        <input type="text" id="warrantyDateTo" name="warrantyDateTo" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
    </div>

    <div class="layui-form-item layui-form-text" style="width:1280px;">
        <label class="layui-form-label">参数说明</label>
        <div class="layui-input-block">
            <textarea placeholder="请输入内容" class="layui-textarea" name="parameterDescription" id="parameterDescription"></textarea>
        </div>
    </div>

    <div class="layui-form-item" style="width:1280px;">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-block">
            <input type="text" name="remarks" id="remarks" lay-verify="" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
        </div>
    </div>
    </form>
</div>
</body>
<script src="../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="../../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['form', 'layedit', 'laydate', "tableSelect"], function () {
        var form = layui.form
            , layer = layui.layer
            , layedit = layui.layedit
            , laydate = layui.laydate
            , tableSelect = layui.tableSelect
            , $ = layui.jquery
        tableSelect.render({
            elem: '#projectId',
            searchKey: 'projectName',
            checkedKey: 'projectId',
            searchPlaceholder: '请输入条件',
            table: {
                url: '/management/project/all',
                cols: [[
                    {type: 'checkbox'},
                    {field: 'projectId', title: '项目Id', width: 300},
                    {field: 'projectName', title: '项目名称', width: 300}
                ]]
            },
            done: function (elem, data) {
                var NEWJSON = []
                layui.each(data.data, function (index, item) {
                    NEWJSON.push(item.projectId)
                })
                elem.val(NEWJSON.join(","))
            }
        })
        //日期
        laydate.render({
            elem: '#purchaseDate',
            format:'yyyy/MM/dd'
        });
        laydate.render({
            elem: '#warrantyDateTo',
            format:'yyyy/MM/dd'
        });
        //直接将金额计算得出
        $( "#quantity").bind("input propertychange",function () {
            var quantity = $('#quantity').val();
            var unitPrice = $('#unitPrice').val();
            console.log("quantity:"+quantity+"           unitPrice:"+unitPrice);
            if(!isNaN(quantity) && !isNaN(unitPrice)){
                var res = parseFloat(quantity)*parseFloat(unitPrice);
                $("#amount").val(res);
            }
        });
        $( "#unitPrice").bind("input propertychange",function () {
            var quantity = $('#quantity').val();
            var unitPrice = $('#unitPrice').val();
            console.log("quantity:"+quantity+"           unitPrice:"+unitPrice);
            if(!isNaN(quantity) && !isNaN(unitPrice)){
                var res = parseFloat(quantity)*parseFloat(unitPrice);
                $("#amount").val(res);
            }
        });
        //将select得到的值直接转化成日期
        function formatMonth(num){
            var str;
            if(num<10){
                str = "0"+num;
            }else{
                str = ""+num;
            }
            return str;
        }
        // dateArr 0代表年 1代表月 2代表日 caseValue代表增加的月份
        function getNewDate(dateArr , caseValue){
            if(Number(dateArr[1])<12-(caseValue-1)){
                dateArr[1] = formatMonth( (Number(dateArr[1])+caseValue) );
            }else {
                dateArr[0] = Number(dateArr[0])+1+"";
                dateArr[1] = formatMonth((Number(dateArr[1])+caseValue-12));
            }
            var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
            return newDate;
        }
        form.on('select(warrantyDays)', function(data){
            var purchaseDate = $('#purchaseDate').val();
            var dateArr = purchaseDate.split("/");
            switch (Number(data.value)) {
                case 0 :
                    laydate.render({elem: '#warrantyDateTo',value: purchaseDate});
                    break;
                case 1 :
                    laydate.render({elem: '#warrantyDateTo',value: getNewDate(dateArr,Number(data.value))});
                    break;
                case 3 :
                    laydate.render({elem: '#warrantyDateTo',value: getNewDate(dateArr,Number(data.value))});
                    break;
                case 6 :
                    laydate.render({elem: '#warrantyDateTo',value: getNewDate(dateArr,Number(data.value))});
                    break;
                case 12 :
                    //直接加一年
                    dateArr[0] = Number(dateArr[0])+1+"";
                    var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                    laydate.render({elem: '#warrantyDateTo',value: newDate});
                    break;
                case 24 :
                    dateArr[0] = Number(dateArr[0])+2+"";
                    var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                    laydate.render({elem: '#warrantyDateTo',value: newDate});
                    break;
                case 36 :
                    dateArr[0] = Number(dateArr[0])+3+"";
                    var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                    laydate.render({elem: '#warrantyDateTo',value: newDate});
                    break;
                case 48 :
                    dateArr[0] = Number(dateArr[0])+4+"";
                    var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                    laydate.render({elem: '#warrantyDateTo',value: newDate});
                    break;
                case 60 :
                    dateArr[0] = Number(dateArr[0])+5+"";
                    var newDate = ""+dateArr[0]+"/"+dateArr[1]+"/"+dateArr[2];
                    laydate.render({elem: '#warrantyDateTo',value: newDate});
                    break;
            }
        });
        form.on('submit(saveBtn)',function (data) {
            //拿到所有数据
            var dataAll = form.val('addAssetMSG');
            console.log(dataAll.warrantyDateTo);
            $.ajax({
                url:"/management/asset/insert",
                type:"POST",
                dataType: "JSON",
                data:dataAll,
                success: function(data){
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                    // window.history.go(-1);
                }
            })
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    })
</script>